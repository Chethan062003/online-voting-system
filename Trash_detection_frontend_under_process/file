<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoBotics</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 flex items-center justify-center h-screen" 
      style="background-image: url('/static/images/background.jpeg'); background-size: cover; background-position: center;">

    <div class="w-full max-w-3xl bg-white rounded-lg shadow-lg border border-gray-200">
        <div class="bg-lime-400 text-white p-4 rounded-t-lg text-center">

            <h2 class="text-xl font-bold" style="color: #ecf5ec;">EcoBotics</h2>

            <p class="text-sm">Upload an image or ask questions about waste management</p>
        </div>
        <div id="chat-box" class="p-4 h-96 overflow-auto border-b border-gray-400"></div>
        <div class="p-4 flex items-center gap-2">
            <input id="chat-input" type="text" placeholder="Ask about waste management..." class="flex-1 p-3 border rounded-lg text-gray-700 shadow-sm">
            <input id="image-upload" type="file" accept="image/*" class="hidden">
            <button onclick="document.getElementById('image-upload').click();" class="p-3 bg-green-200 hover:bg-green-300 rounded-lg shadow-md">ðŸ“·</button>
            <button id="send-btn" class="p-3 bg-green-500 hover:bg-green-600 text-white rounded-lg shadow-md">âž¤</button>
            <button id="upload-btn" class="p-3 bg-green-200 hover:bg-green-300 rounded-lg shadow-md">ðŸ“¤</button>
            <button id="clear-btn" class="p-3 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-md">ðŸ—‘</button>
        </div>
    </div>

    <script>
        document.getElementById('send-btn').addEventListener('click', sendMessage);
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
        document.getElementById('clear-btn').addEventListener('click', () => {
            document.getElementById('chat-box').innerHTML = '';
        });
        document.getElementById('image-upload').addEventListener('change', uploadImage);
        document.getElementById('upload-btn').addEventListener('click', uploadImage);

        function sendMessage() {
            const inputField = document.getElementById('chat-input');
            const message = inputField.value.trim();
            if (!message) return;
            addMessage('You', message);
            inputField.value = '';
            fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message})
            })
            .then(res => res.json())
            .then(data => addMessage('Bot', data.history[0].message))
            .catch(() => addMessage('Bot', 'Error processing request.'));
        }

        function uploadImage(event) {
            const file = document.getElementById('image-upload').files[0];
            if (!file) return;
            const formData = new FormData();
            formData.append('image', file);
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    addMessage('Bot', data.error);
                } else {
                    addImageMessage('You', URL.createObjectURL(file));
                    addMessage('Bot', data.history[0].message);
                }
            })
            .catch(() => addMessage('Bot', 'Error uploading image.'));
        }

        function addMessage(sender, message) {
            const chatBox = document.getElementById('chat-box');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('p-2', sender === 'You' ? 'text-right' : 'text-left');
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function addImageMessage(sender, imageUrl) {
            const chatBox = document.getElementById('chat-box');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('p-2', sender === 'You' ? 'text-right' : 'text-left');
            messageDiv.innerHTML = `<strong>${sender}:</strong><br><img src="${imageUrl}" class="max-w-xs rounded-lg shadow-md mt-2">`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
